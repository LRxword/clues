<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>cluematch</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

<link href="https://fonts.googleapis.com/css2?family=Sansita:wght@900&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="https://hammerjs.github.io/dist/hammer.min.js"></script>

<style>
:root { --bg:#cce7ff; --card-shadow:#000; --black:#111; }
*{box-sizing:border-box;}
body{
  margin:0; font-family:'Montserrat',sans-serif; background:var(--bg);
  min-height:100vh; display:flex; flex-direction:column; align-items:center;
  padding:1.6rem 1rem 6rem; color:var(--black);
}
h1{font-family:'Sansita',sans-serif;font-weight:900;font-size:3.4rem;margin:0 0 0.8rem 0;text-align:center;color:var(--black);}
#tabs{display:flex;gap:0.8rem;margin-bottom:0.6rem;}
.tab{padding:0.5rem 1rem;border-radius:18px;border:2px solid var(--black);background:white;cursor:pointer;font-weight:700;box-shadow:3px 3px 0 var(--card-shadow);color:var(--black);user-select:none;}
.tab.active{background:var(--black);color:white;}
#assessmentCounts{font-size:1.05rem;margin:0.4rem 0;color:var(--black);}
#progress{width:90vw;max-width:520px;height:6px;background:rgba(255,255,255,0.4);border-radius:4px;overflow:hidden;margin-bottom:0.4rem;}
#progressBar{height:100%;width:0%;background:#ffe6e6;transition:width .25s ease;}
#progressCount{font-size:1.2rem;margin-bottom:1rem;color:var(--black);text-align:center;}
#card{width:90vw;max-width:560px;background:white;border:3px solid var(--black);border-radius:20px;padding:1.6rem;box-shadow:4px 4px 0 var(--card-shadow);text-align:center;margin-bottom:1.2rem;transition:transform .36s ease,opacity .36s ease;font-size:2.2rem;color:var(--black);}
#card.enter{transform:translateX(0) scale(1);opacity:1;}
#card.swipe-left{transform:translateX(-150%) rotate(-20deg);opacity:0;}
#card.swipe-right{transform:translateX(150%) rotate(20deg);opacity:0;}
#card.swipe-down{transform:translateY(150%) rotate(15deg);opacity:0;}
#clue{font-size:2.2rem;color:#222;margin-bottom:0.8rem;white-space:pre-wrap;}
#answer{display:inline-block;font-family:'Sansita',sans-serif;font-weight:900;font-size:2.2rem;background:black;color:black;padding:0 0.3rem;border-radius:6px;letter-spacing:0.2em;cursor:pointer;transition:background .25s ease,color .25s ease,letter-spacing .25s;}
#answer.revealed{background:none;color:var(--black);letter-spacing:normal;}
#writer{margin-top:1rem;font-size:1.05rem;color:#555;}
#resetBtn {
  background: #ff4d4d; /* red background */
  color: white;         /* text color */
  border-radius: 6px;   /* optional, to make it look nicer */
  padding: 0.4rem 0.6rem;
}
  #buttons {
  display: flex;
  gap: 0.4rem; /* reduce gap slightly */
  flex-wrap: wrap;
  width: 90vw;
  max-width: 520px;
  justify-content: space-between;
  margin-bottom: 2rem; /* pull buttons slightly up to fit */
}
  .btn {
  flex: 1 1 90px; /* slightly narrower min-width */
  padding: 0.5rem 0.6rem; /* slightly smaller padding */
}
  .btn.ghost{background:#eee;}
#bottomBar{position:fixed;bottom:0;left:0;width:100%;display:flex;height:64px;background:#222;color:white;box-shadow:0 -6px 12px rgba(0,0,0,0.15);}
#bottomBar button{flex:1;border:none;background:transparent;color:white;font-weight:700;font-size:1rem;cursor:pointer;}
#bottomBar button:hover{background:rgba(255,255,255,0.04);}
#noteOverlay{display:none;position:fixed;top:10%;left:50%;transform:translateX(-50%);width:70%;max-width:360px;background:white;border:3px solid var(--black);border-radius:16px;padding:1rem;box-shadow:6px 6px 0 var(--card-shadow);z-index:2000;}
#noteText{width:100%;height:140px;font-size:2.2rem;padding:0.8rem;border-radius:10px;border:2px solid var(--black);resize:none;line-height:1.2;}
#noteOverlay .saveBtn{margin-top:0.8rem;display:inline-block;padding:0.5rem 0.8rem;border-radius:12px;border:2px solid var(--black);background:#222;color:white;font-weight:700;cursor:pointer;}
.hidden{display:none;}
</style>
</head>
<body>
<h1 style="display:flex;align-items:center;gap:0.6rem;">
  <img src="data:image/png;base64,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" alt="Logo" style="height:2.6rem;">
  cluematch
</h1>
<div id="tabs">
<div class="tab active" data-source="members">Members</div>
<div class="tab" data-source="setters">Setters</div>
<div class="tab" data-source="book">Book</div>
<div class="tab" data-source="clues">Clues</div>
</div>
<div id="assessmentCounts">No: 0 | OK: 0 | Great: 0</div>
<div id="progress"><div id="progressBar"></div></div>
<div id="progressCount">0 / 0</div>
<div id="card" style="display:none;">
<div id="clue">Loading clue…</div>
<div>
<strong>Answer:</strong>
<span id="answer" onclick="toggleAnswer(this)" data-answer="">████████</span>
</div>
<p id="writer"></p>
</div>
<div id="buttons">
<button class="btn" id="btnNo" onclick="animateSwipe('left',()=>recordAssessment('No'))">No</button>
<button class="btn" id="btnOK" onclick="animateSwipe('right',()=>recordAssessment('OK'))">OK</button>
<button class="btn" id="btnGreat" onclick="animateSwipe('down',()=>recordAssessment('Great'))">Great</button>
<button class="btn" id="btnNote" onclick="openNote()">Note</button>
<button class="btn ghost" id="btnUndo" onclick="undoAssessment()">Undo</button>
</div>
<div id="noteOverlay">
<textarea id="noteText" placeholder="Write your note here..."></textarea>
<div style="display:flex;gap:8px;justify-content:flex-end;">
<button class="saveBtn" onclick="saveNote()">Save</button>
<button class="saveBtn" onclick="closeNote()">Close</button>
</div>
</div>
<div id="bottomBar">
<button id="exportBtn" onclick="exportCSV()">Download Reviewed CSV</button>
<button id="resetBtn" onclick="resetProgress()">Reset Progress</button>
</div>

<script>
let clues=[],current=0,currentSource='members',counts={No:0,OK:0,Great:0};
const history=[],tabs=document.querySelectorAll('.tab');
const cardEl=document.getElementById('card'),clueEl=document.getElementById('clue'),answerEl=document.getElementById('answer');
const writerEl=document.getElementById('writer'),progressBar=document.getElementById('progressBar');
const progressCount=document.getElementById('progressCount'),assessmentCounts=document.getElementById('assessmentCounts');
const noteOverlay=document.getElementById('noteOverlay'),noteText=document.getElementById('noteText');

const sheetUrls={
members:"https://docs.google.com/spreadsheets/d/e/2PACX-1vSsSUD7PgliCuhNkFFA3nyjes14LHlg1Gp2wuLlG5DU6FIp4CwP0lbrmGLuGe_DlhlbdM6fh_xwb2sZ/pub?output=csv",
setters:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTehLOvfLYgi1hKeHIP9z9MamhTvO4g0fSFFN9u4RTxmbYzeHBpan9AX8qS4A_UCBmZIHHCDUAZZpkT/pub?output=csv",
book:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQkx8S8wEjszf103yOxaKlP7ZgBwKkaGfvDDR0dAzFsVslo1bRGVC-gYYZ9-mn-v7f6Sz4PoKhvgswo/pub?output=csv",
clues:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTif8KzuwqF_THEi6RRM7VnWbAHwX4awQge_XiAMSsk91zBD6mYq4Ns5nqaH0c2EiPqSbP7Gl4L6h4_/pub?output=csv"
};

function setActiveTab(source){
tabs.forEach(t=>t.classList.toggle('active',t.dataset.source===source));
currentSource=source;
document.getElementById('btnNo').style.display = source==='clues'?'none':'';
document.getElementById('btnOK').style.display = source==='clues'?'none':'';
document.getElementById('btnGreat').style.display = source==='clues'?'none':'';
loadSheet();
}

tabs.forEach(t=>t.addEventListener('click',()=>setActiveTab(t.dataset.source)));

function loadSheet(){
cardEl.style.display='none';
clueEl.textContent='Loading...';
progressCount.textContent='…';
progressBar.style.width='0%';
const url=sheetUrls[currentSource];
if(!url){clues=[];current=0;updateCounts();updateProgress();showNext();return;}
Papa.parse('https://corsproxy.io/?'+url,{download:true,header:true,skipEmptyLines:true,
complete: results=>{
const rows=(results && results.data)?results.data.map(r=>({
Clue:r.Clue||r.clue||'',
Answer:r.Answer||r.answer||r.Word||r.word||'',
Writer:r.Writer||r.writer||r.Author||r.author||'',
Note:r.Note||r.note||'',
Assessment:r.Assessment||r.assessment||''
})):[];

clues=rows;
const saved=localStorage.getItem('clueMatchProgress_'+currentSource);
if(saved){try{const sd=JSON.parse(saved);if(sd.clues && Array.isArray(sd.clues)){clues=sd.clues;current=sd.current||0;}else current=0;}catch(e){current=0;}}else current=0;
history.length=0;
updateCounts();updateProgress();showNext();
},error: err=>{console.warn('CSV load failed:',err);clues=[];current=0;clueEl.textContent='Failed to load sheet — check URL.';cardEl.style.display='block';updateCounts();updateProgress();}
});
}

function updateCounts(){counts.No=counts.OK=counts.Great=0;clues.forEach(c=>{if(c.Assessment)counts[c.Assessment]=(counts[c.Assessment]||0)+1;});assessmentCounts.textContent=`No: ${counts.No} | OK: ${counts.OK} | Great: ${counts.Great}`;}
function updateProgress(){const total=clues.length||0;progressBar.style.width=total===0?'0%':`${(current/total)*100}%`;progressCount.textContent=`${Math.min(current+1,total)}/${total}`;}

function showNext(){
if(clues.length===0){clueEl.textContent='No clues loaded.';answerEl.textContent='████████';answerEl.classList.remove('revealed');writerEl.textContent='';cardEl.style.display='block';return;}
if(current>=clues.length){clueEl.textContent='All done!';answerEl.textContent='';writerEl.textContent='';cardEl.style.display='block';document.getElementById('buttons').style.display='none';progressBar.style.width='100%';progressCount.textContent=`${clues.length}/${clues.length}`;return;}
const row=clues[current];
if(currentSource==='clues'){
    clueEl.textContent='Write a clue for this word:';
    answerEl.textContent=row.Answer||'(no word)';
    answerEl.setAttribute('data-answer', row.Answer||'');
    answerEl.classList.remove('revealed'); // hidden until clicked
    writerEl.textContent=row.Writer?`Source: ${row.Writer}`:'';
}else{
    clueEl.textContent=row.Clue||'(no clue)';
    answerEl.setAttribute('data-answer',row.Answer||'');
    answerEl.textContent='████████';
    answerEl.classList.remove('revealed');
    writerEl.textContent=row.Writer?`Writer: ${row.Writer}`:'';
    document.getElementById('buttons').style.display='';
}
cardEl.style.display='block';cardEl.className='';void cardEl.offsetWidth;cardEl.classList.add('enter');updateProgress();updateCounts();
}

function toggleAnswer(el){if(el.classList.contains('revealed')){el.classList.remove('revealed');el.textContent='████████';}else{el.classList.add('revealed');el.textContent=el.getAttribute('data-answer')||'';}}

const flash=document.createElement('div');flash.id='flash';flash.style.position='fixed';flash.style.top='40%';flash.style.left='50%';flash.style.transform='translate(-50%,-50%)';flash.style.fontSize='3.5rem';flash.style.pointerEvents='none';flash.style.opacity='0';flash.style.transition='opacity .35s, transform .35s';document.body.appendChild(flash);
function flashMessage(sym){flash.textContent=sym;flash.style.opacity='1';flash.style.transform='translate(-50%,-50%) scale(1.05)';setTimeout(()=>{flash.style.opacity='0';flash.style.transform='translate(-50%,-50%) scale(1)';},650);}

function animateSwipe(direction,callback){
cardEl.classList.add(`swipe-${direction}`);
if(currentSource==='clues' && direction==='down'){
  setTimeout(()=>{current++;showNext();},360);return;
}
const emoji={left:'❌',right:'👍',down:'⭐'}[direction]||'';
flashMessage(emoji);
setTimeout(()=>{cardEl.className='';callback();current++;showNext();},420);
}

function recordAssessment(value){if(currentSource==='clues') return;if(current>=clues.length) return;clues[current].Assessment=value;saveProgress();history.push(current);current++;updateCounts();showNext();}
function undoAssessment(){if(history.length===0)return;current=history.pop();saveProgress();showNext();updateCounts();}
function openNote(){if(clues.length===0)return;noteText.value=clues[current].Note||'';noteOverlay.style.display='block';}
function closeNote(){noteOverlay.style.display='none';noteText.blur();}
function saveNote(){if(clues.length===0){closeNote();return;}clues[current].Note=noteText.value.trim();saveProgress();closeNote();}
function exportCSV(){const out=clues.filter(r=>r && (r.Assessment || (r.Note && r.Note.trim().length>0)));if(out.length===0){alert('No reviewed clues or notes to export.');return;}const data=out.map(r=>({Clue:r.Clue||'',Answer:r.Answer||'',Writer:r.Writer||'',Assessment:r.Assessment||'',Note:r.Note||''}));const csv=Papa.unparse(data,{quotes:true});const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`reviewed_clues_${currentSource}.csv`;link.click();}
function saveProgress(){try{localStorage.setItem('clueMatchProgress_'+currentSource,JSON.stringify({current,clues}));}catch(e){console.warn('save failed',e);}}
function resetProgress(){if(!confirm('Reset progress for this source?'))return;localStorage.removeItem('clueMatchProgress_'+currentSource);current=0;clues=[];loadSheet();}

const mc=new Hammer(document.body);mc.get('swipe').set({direction:Hammer.DIRECTION_ALL});
mc.on('swipeleft',()=>{if(currentSource!=='clues')animateSwipe('left',()=>recordAssessment('No'));});
mc.on('swiperight',()=>{if(currentSource!=='clues')animateSwipe('right',()=>recordAssessment('OK'));});
mc.on('swipedown',()=>{animateSwipe('down',()=>{if(currentSource!=='clues')recordAssessment('Great');});});

document.addEventListener('DOMContentLoaded',()=>{setActiveTab('members');});

window.openNote=openNote;window.saveNote=saveNote;window.closeNote=closeNote;window.animateSwipe=animateSwipe;
window.recordAssessment=recordAssessment;window.undoAssessment=undoAssessment;window.toggleAnswer=(el)=>toggleAnswer(el);window.exportCSV=exportCSV;
window.resetProgress=resetProgress;
</script>
</body>
</html>
